{% extends 'base.html' %}

{% block content %}

<style>
    .search-and-add {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
        margin-bottom: 20px;
    }

    .search-and-add form {
        flex-grow: 1;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .search-and-add form .form-control,
    .search-and-add form .btn,
    .search-and-add form .form-select {
        flex-grow: 1;
        margin-bottom: 10px;
    }

    .table-responsive {
        margin-bottom: 20px;
    }

    @media (min-width: 576px) {
    .search-and-add {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }

    .search-and-add form {
        display: flex;
        flex-grow: 1;
        gap: 10px;
    }

    .search-and-add .form-control {
        flex-grow: 2; /* Allows search bar to grow and use available space */
        margin-bottom: 0; /* Removes the margin at the bottom */
    }

    .search-and-add .form-select {
        flex-grow: 1; /* Allows the select box to grow but with less priority than search bar */
        flex-basis: 150px; /* Gives a default width to the select box */
    }

    .search-and-add .btn-search {
        flex-grow: 0; /* Prevents search button from growing */
    }

    .add-receipt-btn {
        flex-grow: 0; /* Prevents add button from growing */
        white-space: nowrap; /* Ensures text doesn't wrap */
    }
}

</style>

<div class="container">
    <h1 class="text-center bg-primary text-white py-2">Receipts</h1>
    <div class="search-and-add">
        <form method="get" action="." class="flex-grow-1 d-flex">
            <input type="text" name="search" class="form-control" placeholder="Search receipts..." value="{{ request.GET.search }}">
            <button type="submit" class="btn btn-primary">Search</button>
            <select name="per_page" class="form-select" onchange="this.form.submit()">
                <option value="10" {% if request.GET.per_page == "10" %}selected{% endif %}>10 per page</option>
                <option value="20" {% if request.GET.per_page == "20" %}selected{% endif %}>20 per page</option>
                <option value="50" {% if request.GET.per_page == "50" %}selected{% endif %}>50 per page</option>
            </select>
        <a href="{% url 'create_receipt' %}" class="btn btn-success add-receipt-btn">Add New Receipt</a>

    </form>


    <table class="table">
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Contact Number</th>            
            <th scope="col" class="d-none d-md-table-cell">Invoice Number</th>
            <th>Amount</th>
            <th scope="col" class="d-none d-md-table-cell">Reference Number</th>
            <th>Actions</th>
        </tr>
        {% for receipt in receipts %}
        <tr>
            <td>{{ receipt.id }}</td>
            <td>{{ receipt.name }}</td>
            <td>{{ receipt.contact_number }}</td>
            <td  class="d-none d-md-table-cell">{{ receipt.invoice_number }}</td>
            <td>{{ receipt.amount }}</td>
            <td class="d-none d-md-table-cell">{{ receipt.reference_number }}</td>
            <td>
                <a href="{% url 'generate_pdf' receipt.id %}" class="btn btn-primary">Generate</a>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="7">No receipts found.</td>
        </tr>
        {% endfor %}
    </table>

    <!-- Pagination navigation -->
    <div class="pagination">
        <span class="step-links">
            {% if receipts.has_previous %}
                <a href="?page=1{% if query %}&search={{ query }}{% endif %}">&laquo; first</a>
                <a href="?page={{ receipts.previous_page_number }}{% if query %}&search={{ query }}{% endif %}">previous</a>
            {% endif %}

            <span class="current">
                Page {{ receipts.number }} of {{ receipts.paginator.num_pages }}.
            </span>

            {% if receipts.has_next %}
                <a href="?page={{ receipts.next_page_number }}{% if query %}&search={{ query }}{% endif %}">next</a>
                <a href="?page={{ receipts.paginator.num_pages }}{% if query %}&search={{ query }}{% endif %}">last &raquo;</a>
            {% endif %}
        </span>
    </div>

</div>
{% endblock %}
